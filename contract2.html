<?php include("config.php"); ?>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</title>
<style>
:root{--g1:#0a1628;--g2:#1a2d50;--g3:#274472;--g4:#3a6098}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:linear-gradient(135deg,var(--g1),var(--g2),var(--g3));min-height:100vh;padding-bottom:80px}
.hd{background:rgba(0,0,0,.2);color:#fff;padding:20px;text-align:center}
.hd h2{margin:0;display:flex;align-items:center;justify-content:center;gap:10px}
.wrap{display:flex;gap:25px;max-width:1100px;margin:30px auto;padding:0 15px;flex-wrap:wrap;justify-content:center}
.box{flex:1;min-width:300px;width:100%;max-width:520px;background:#fff;padding:30px;border-radius:16px;box-shadow:0 15px 40px rgba(0,0,0,.25)}
.box h3{color:var(--g2);text-align:center;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid var(--g4);display:flex;align-items:center;justify-content:center;gap:8px}
label{display:block;margin-top:14px;font-weight:600;color:#333;font-size:13px}
input,select{width:100%;padding:12px;margin-top:6px;border:2px solid #e0e0e0;border-radius:10px;font-size:14px;transition:all 0.3s}
input:focus,select:focus{outline:none;border-color:var(--g3);box-shadow:0 0 0 3px rgba(39,68,114,.15)}
button{margin-top:20px;width:100%;padding:14px;background:linear-gradient(135deg,var(--g3),var(--g2));color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;box-shadow:0 5px 15px rgba(26,45,80,.4);transition:all 0.3s}
button:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(26,45,80,.5)}
.msg{padding:12px;border-radius:10px;text-align:center;margin-bottom:15px}
.msg.success{background:var(--g3);color:#fff}
.msg.error{background:#e53935;color:#fff}
.hist{max-width:900px;margin:25px auto;padding:0 15px}
.hist .box{max-width:100%;min-width:auto}
.table-container{width:100%;overflow-x:auto;margin-top:10px}
table{width:100%;border-collapse:collapse;min-width:700px}
th,td{padding:12px;text-align:center;border:1px solid #bdc3c7}
th{background:var(--g2);color:#fff;font-weight:600;font-size:14px}
td{color:#333;font-size:14px}
tr:nth-child(even){background:#f8fafc}
tr:hover td{background:#e3f2fd;color:var(--g2);cursor:default}
.row{display:flex;gap:15px}
.row .col{flex:1}
.status{display:inline-block;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:600}
.status.active{background:#d0e4f7;color:#1a2d50}
.status.expired{background:#ffcdd2;color:#c62828}

/* Navigation Bar */
.nav-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,0.98);padding:12px 20px;box-shadow:0 -4px 20px rgba(0,0,0,0.15);display:flex;justify-content:center;align-items:center;gap:15px;z-index:1000}
.nav-btn{display:flex;align-items:center;gap:8px;padding:12px 24px;border-radius:10px;text-decoration:none;font-weight:600;font-size:14px;transition:all 0.3s;border:none;cursor:pointer}
.nav-btn.prev{background:linear-gradient(135deg,#78909c,#546e7a);color:#fff}
.nav-btn.prev:hover{transform:translateX(-5px);box-shadow:0 4px 15px rgba(84,110,122,0.4)}
.nav-btn.home{background:linear-gradient(135deg,var(--g3),var(--g2));color:#fff}
.nav-btn.home:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(26,45,80,0.5)}
.nav-btn.next{background:linear-gradient(135deg,#42a5f5,#1e88e5);color:#fff}
.nav-btn.next:hover{transform:translateX(5px);box-shadow:0 4px 15px rgba(30,136,229,0.4)}
.nav-btn.disabled{background:#e0e0e0;color:#9e9e9e;cursor:not-allowed;pointer-events:none}
.nav-info{text-align:center;color:#666;font-size:12px}
.nav-info strong{color:var(--g2)}
</style>
</head>
<body>

<div class="hd">
    <h2>üìÑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</h2>
</div>

<div class="wrap">
    <div class="box">
        <h3>üìù ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
        
        <?php
        if(isset($_POST['save'])){
            $tenant_id = $_POST['tenant_id'];
            $start_date = $_POST['start_date'];
            $end_date = $_POST['end_date'];
            $rent = $_POST['rent'];

            $sql = "INSERT INTO contract (tenant_id, start_date, end_date, rent) 
                    VALUES ('$tenant_id', '$start_date', '$end_date', '$rent')";
            
            if(mysqli_query($conn, $sql)){
                echo "<div class='msg success'>‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>";
            } else {
                echo "<div class='msg error'>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " . mysqli_error($conn) . "</div>";
            }
        }
        ?>
        
        <form method="post">
            <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤ / ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</label>
            <select name="tenant_id" required>
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤ --</option>
                <?php
                $tenants = mysqli_query($conn, "SELECT tenant_id, name, room_no FROM tenant ORDER BY tenant_id");
                while($t = mysqli_fetch_assoc($tenants)){
                    echo "<option value='".$t['tenant_id']."'>[".$t['tenant_id']."] ".$t['name']." - ‡∏´‡πâ‡∏≠‡∏á ".$t['room_no']."</option>";
                }
                ?>
            </select>
            
            <div class="row">
                <div class="col">
                    <label>üìÖ ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡∏ç‡∏ç‡∏≤</label>
                    <input type="date" name="start_date" required>
                </div>
                <div class="col">
                    <label>üìÖ ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤</label>
                    <input type="date" name="end_date" required>
                </div>
            </div>
            
            <label>üí∞ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" name="rent" min="0" step="0.01" placeholder="0.00" required>
            
            <button type="submit" name="save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏±‡∏ç‡∏ç‡∏≤</button>
        </form>
    </div>
</div>

<div class="hist">
    <div class="box">
        <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div class="table-container">
        <table>
            <tr>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏±‡∏ç‡∏ç‡∏≤</th>
                <th>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</th>
                <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
                <th>‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
                <th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            </tr>
<?php
$result = mysqli_query($conn, "SELECT c.*, t.name as tenant_name FROM contract c LEFT JOIN tenant t ON c.tenant_id = t.tenant_id ORDER BY c.contract_id DESC");
if(mysqli_num_rows($result) > 0){
    while($row = mysqli_fetch_assoc($result)){
        $today = date('Y-m-d');
        $isActive = ($row['start_date'] <= $today && $row['end_date'] >= $today);
        $statusClass = $isActive ? 'active' : 'expired';
        $statusText = $isActive ? '‡∏°‡∏µ‡∏ú‡∏•' : '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
        
        echo "<tr>";
        echo "<td>".$row['contract_id']."</td>";
        echo "<td>".($row['tenant_name'] ?? 'ID: '.$row['tenant_id'])."</td>";
        echo "<td>".date('d/m/Y', strtotime($row['start_date']))."</td>";
        echo "<td>".date('d/m/Y', strtotime($row['end_date']))."</td>";
        echo "<td>‡∏ø".number_format($row['rent'],2)."</td>";
        echo "<td><span class='status ".$statusClass."'>".$statusText."</span></td>";
        echo "</tr>";
    }
}else{
    echo "<tr><td colspan='6' style='color:#888;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ç‡∏ç‡∏≤</td></tr>";
}
?>
        </table>
        </div>
    </div>
</div>

<!-- Navigation Bar -->
<div class="nav-bar">
    <a href="owner.php" class="nav-btn prev">‚¨ÖÔ∏è ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</a>
    <div class="nav-info">
        <strong>3</strong> / 4<br>
        <small>‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏ä‡πà‡∏≤</small>
    </div>
    <a href="index.php" class="nav-btn home">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    <a href="payment.php" class="nav-btn next">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è</a>
</div>

</body>
</html>
